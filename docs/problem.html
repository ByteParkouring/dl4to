---

title: Problem


keywords: fastai
sidebar: home_sidebar



nb_path: "notebooks/problem/2_problem.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/problem/2_problem.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Problem class contains all information of the underlying topology optimization (TO) problem one intends to solve. 
We focus on isotropic materials that are linearly elastic. This comprises most common materials, e.g., including steel and aluminum. Since we perform optimization on structured grids, all information is either in scalar or in tensor form. This makes data compatible with DL applications since it allows for a shape-consistent tensor representation. Let $(n_x, n_y, n_z)$ be the number of voxels in each spacial direction, i.e. the shape of the TO problem.</p>
<p>We can create unique problem objects characterized by the following inputs:</p>
<ul>
<li><p>Scalar material properties that define the physical proporties of the underlying material. These include:</p>
<ul>
<li>Young's modulus $E&gt;0$</li>
<li>Poisson's ratio $\nu\in [0, 0.5]$</li>
<li>The yield stress $\sigma_{ys}&gt;0$</li>
</ul>
</li>
<li><p>A three-dimensional vector $h$ that defines the voxel sizes in meters in each direction.</p>
</li>
<li><p>A binary ($3\times n_x \times n_y \times n_z$)-tensor called $\Omega_\text{dirichlet}$ which we use to encode the presence of directional homogeneous Dirichlet boundary conditions for every voxel. These boundary conditions determine where the structure is "locked" in place, i.e. where the displacements are fixed at 0. $1$s indicate the presence, and $0$s the absence of homogeneous Dirichlet boundary conditions. Currently, we do not support non-homogeneous Dirichlet boundary conditions (i.e. voxels that have displacements fixed at some value $\neq 0$) since we believe that they are not required for most TO tasks.</p>
</li>
<li><p>A ($1\times n_x \times n_y \times n_z$)-tensor called $\Omega_\text{design}$ containing values $\in \left\lbrace 0,1,-1\right\rbrace$ that we use to encode design space information. We use $0$s and $1$s to constrain voxel densities to be $0$ or $1$, respectively. Entries of $-1$ indicate a lack of density constraints, which signifies that the density in that voxel can be freely optimized.</p>
</li>
<li><p>A ($3\times n_x \times n_y \times n_z$)-tensor called $F$, which encodes external forces given in $\text{N}/\text{m}^3$. The three channels correspond to the force magnitudes in each spacial dimension. For voxels that have external loads assigned to them we automatically enforce the corresponding density value to be $1$.</p>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Problem" class="doc_header"><code>class</code> <code>Problem</code><a href="dl4to/problem.py#L153" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Problem</code>(<strong><code>E</code></strong>:<code>float</code>, <strong><code>ν</code></strong>:<code>float</code>, <strong><code>σ_ys</code></strong>:<code>float</code>, <strong><code>h</code></strong>:<code>Union</code>[<code>float</code>, <code>list</code>], <strong><code>Ω_dirichlet</code></strong>:<code>Tensor</code>, <strong><code>Ω_design</code></strong>:<code>Tensor</code>, <strong><code>F</code></strong>:<code>Tensor</code>, <strong><code>pde_solver</code></strong>:<code>dl4to.pde.PDESolver</code>=<em><code>None</code></em>, <strong><code>name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>device</code></strong>:<code>str</code>=<em><code>'cpu'</code></em>, <strong><code>dtype</code></strong>:<code>dtype</code>=<em><code>torch.float32</code></em>, <strong><code>restrict_density_for_voxels_with_applied_forces</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>A class containing all parameters for defining a topology optimization problem.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>E</code></strong></td>
<td><code>float</code></td>
<td></td>
<td>The Young's modulus of the material. Given in Pa.</td>
</tr>
<tr>
<td><strong><code>ν</code></strong></td>
<td><code>float</code></td>
<td></td>
<td>The Poisson's ratio of the material. Dimensionless.</td>
</tr>
<tr>
<td><strong><code>σ_ys</code></strong></td>
<td><code>float</code></td>
<td></td>
<td>The yield stress σ_ys denotes the critical von Mises stress at which the material starts yielding. Given in Pa.</td>
</tr>
<tr>
<td><strong><code>h</code></strong></td>
<td><code>typing.Union[float, list]</code></td>
<td></td>
<td>The length of the edges of the cuboid voxels. Equal to the discretisation step size in each coordinate direction.</td>
</tr>
<tr>
<td><strong><code>Ω_dirichlet</code></strong></td>
<td><code>Tensor</code></td>
<td></td>
<td>A tensor denoting the presence of homogeneous Dirichlet boundary conditions in each voxel in each coordinate direction.</td>
</tr>
<tr>
<td><strong><code>Ω_design</code></strong></td>
<td><code>Tensor</code></td>
<td></td>
<td>A tensor denoting the kind of design space assigned to each voxel. Values of "0" and "1" indicate a material density fixed at 0 or 1, respectively. "-1" indicates the absence of constraints, i.e., the voxel density can be freely optimized.</td>
</tr>
<tr>
<td><strong><code>F</code></strong></td>
<td><code>Tensor</code></td>
<td></td>
<td>A tensor denoting the forces applied to each voxel in each coordinate direction. Given in N/m^3.</td>
</tr>
<tr>
<td><strong><code>pde_solver</code></strong></td>
<td><code>dl4to.pde.PDESolver</code></td>
<td><code>None</code></td>
<td>A dl4to PDE Solver object that is attached to this problem.</td>
</tr>
<tr>
<td><strong><code>name</code></strong></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>The name of the problem</td>
</tr>
<tr>
<td><strong><code>device</code></strong></td>
<td><code>str</code></td>
<td><code>cpu</code></td>
<td>The device that this problem is to be stored on. Possible options are "cpu" and "cuda".</td>
</tr>
<tr>
<td><strong><code>dtype</code></strong></td>
<td><code>dtype</code></td>
<td><code>torch.float32</code></td>
<td>The datatype of the problem.</td>
</tr>
<tr>
<td><strong><code>restrict_density_for_voxels_with_applied_forces</code></strong></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Determines whether Ω_design should be set to "1" for voxels that have forces applied to them. Should be turned of in case of volumetric forces like gravity that are applied to all voxels.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Methods">Methods<a class="anchor-link" href="#Methods"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Problem.clone" class="doc_header"><code>Problem.clone</code><a href="dl4to/problem.py#L290" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Problem.clone</code>()</p>
</blockquote>
<p>Returns a deepcopy of the Problem object.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Problem.plot" class="doc_header"><code>Problem.plot</code><a href="dl4to/problem.py#L297" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Problem.plot</code>(<strong><code>display</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>file_path</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>camera_position</code></strong>:<code>Union</code>[<code>list</code>, <code>tuple</code>]=<em><code>(0, 0.1, 0.12)</code></em>, <strong><code>use_pyvista</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>window_size</code></strong>:<code>Union</code>[<code>tuple</code>, <code>list</code>]=<em><code>(800, 800)</code></em>, <strong><code>smooth_iters</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>show_colorbar</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>show_axislabels</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>show_ticklabels</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>export_png</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Renders 3D figures that display the location of Dirichlet boundaries, design space and forces.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>display</code></strong></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Whether the figure is displayed.</td>
</tr>
<tr>
<td><strong><code>file_path</code></strong></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>Path where the figure is saved.</td>
</tr>
<tr>
<td><strong><code>camera_position</code></strong></td>
<td><code>typing.Union[list, tuple]</code></td>
<td><code>(0, 0.1, 0.12)</code></td>
<td>x, y, and z coordinates of the camera position.</td>
</tr>
<tr>
<td><strong><code>use_pyvista</code></strong></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Whether to use pyvista for plotting. If <code>False</code>, then plotly is used. Pyvista generates better looking visualizations, but does not support basic features like colorbars, title display and saving.</td>
</tr>
<tr>
<td><strong><code>window_size</code></strong></td>
<td><code>typing.Union[tuple, list]</code></td>
<td><code>(800, 800)</code></td>
<td>The size of the window that displays the plot. Only has an effect if <code>use_pyvista=True</code>.</td>
</tr>
<tr>
<td><strong><code>smooth_iters</code></strong></td>
<td><code>int</code></td>
<td><code>0</code></td>
<td>The number of smoothing iterations for better looking visualizations. Only has an effect if <code>use_pyvista=True</code>.</td>
</tr>
<tr>
<td><strong><code>show_colorbar</code></strong></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Determines whether a reference colorbar is displayed for the plotted voxel color values.</td>
</tr>
<tr>
<td><strong><code>show_axislabels</code></strong></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Whether the 3d axes are labelled with their dimensions.</td>
</tr>
<tr>
<td><strong><code>show_ticklabels</code></strong></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Whether the 3d axes ticks are displayed and labeled.</td>
</tr>
<tr>
<td><strong><code>export_png</code></strong></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Whether the figure is exported and saved as a png file, in addition to the standard html format.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Examples">Examples<a class="anchor-link" href="#Examples"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># scalar material properties</span>
<span class="n">E</span> <span class="o">=</span> <span class="mf">7e10</span> <span class="c1"># Young&#39;s modulus (in Pascal)</span>
<span class="n">ν</span> <span class="o">=</span> <span class="mf">.3</span> <span class="c1"># Poisson&#39;s ratio</span>
<span class="n">σ_ys</span> <span class="o">=</span> <span class="mf">4.5e8</span> <span class="c1"># Yield stress (in Pascal)</span>

<span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="c1"># number of voxels in x, y and z direction</span>
<span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0250</span><span class="p">,</span> <span class="mf">0.0250</span><span class="p">,</span> <span class="mf">0.0250</span><span class="p">]</span> <span class="c1"># spacial dimensions of each voxel in x, y and direction (in meters)</span>

<span class="c1"># define external forces</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span>
<span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4e7</span> <span class="c1"># external forces (in Newton)</span>

<span class="c1"># define locations of homogeneous Dirichlet conditions</span>
<span class="n">Ω_dirichlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span>
<span class="n">Ω_dirichlet</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># define design space</span>
<span class="n">Ω_design</span> <span class="o">=</span> <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># -1s indicate that these voxels can be freely optimized</span>
<span class="n">Ω_design</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="c1"># we set densities to 1 where there are Dirichlet boundary conditions</span>
<span class="n">Ω_design</span><span class="p">[:,:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="c1"># we set densities to 1 where there are external forces</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">ν</span><span class="p">,</span> <span class="n">σ_ys</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">Ω_dirichlet</span><span class="p">,</span> <span class="n">Ω_design</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">camera_position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">camera_position</span><span class="o">=</span><span class="n">camera_position</span><span class="p">,</span>
             <span class="n">show_axislabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">show_ticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="https://dl4to.github.io/dl4to/images/1_dirichlet.png" alt="dirichlet">
<img src="https://dl4to.github.io/dl4to/images/1_design.png" alt="design">
<img src="https://dl4to.github.io/dl4to/images/1_force_locs.png" alt="force_loc">
<img src="https://dl4to.github.io/dl4to/images/1_force_dirs.png" alt="force_dir"></p>

</div>
</div>
</div>
</div>
 

